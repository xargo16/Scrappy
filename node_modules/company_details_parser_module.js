//External modules
const Knwl = require("./knwl.js");

//variables
var knwlInstance = new Knwl('english');
var listOfCompanyDetails = [];

function getCompanyDetailsFromString(string){
  knwlInstance.init(string);

  var emailObject = knwlInstance.get('emails');
  var phonesObject = knwlInstance.get('phones');
  var placesObject = knwlInstance.get('places');

  //If there are multiple emails, phones or places in the web page then we need
  //to present all of them. We use arrays to hold multiple values
  var emailsList = [];
  var phonesList = [];
  var placesList = [];

  if(emailObject){
    emailObject.forEach(function(item){
      emailsList.push(item.address);
    });
  }

  if(phonesObject){
    phonesObject.forEach(function(item){
      phonesList.push(item.phone);
    });
    //If there are no US formatted phone numbers present then search for UK ones.
    if(!phonesObject[0]){
      phonesList.push(knwlInstance.getUKPhoneNumbers(string));
    }
  }

  if(placesObject){
    placesObject.forEach(function(item){
      placesList.push(item.place);
    });
  }

  var companyDetailsObject = {
    emails: emailsList,
    phones: phonesList,
    addresses: placesList
  };

  return companyDetailsObject;
}

function getPhoneNumbersDifferentThanUSFromString(string){
  var regexesForPhoneNumberPatterns = [];
  var foundPhoneNumber = "";

  var regexForUKPhoneNumber = /[\s\S]*^(((\+44\s?\d{4}|\(?0\d{4}\)?)\s?\d{3}\s?\d{3})|((\+44\s?\d{3}|\(?0\d{3}\)?)\s?\d{3}\s?\d{4})|((\+44\s?\d{2}|\(?0\d{2}\)?)\s?\d{4}\s?\d{4}))(\s?\#(\d{4}|\d{3}))?[\s\S]*$/;
  console.log(string);

  regexesForPhoneNumberPatterns.push(regexForUKPhoneNumber);

  regexesForPhoneNumberPatterns.forEach(function(item){
    if(item.test(string)){
      foundPhoneNumber = string;
      console.log(foundPhoneNumber);
    }
  });

}

module.exports = {
  getCompanyDetailsFromString: getCompanyDetailsFromString
};
